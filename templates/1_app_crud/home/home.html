<!DOCTYPE html>
{% load static %}
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APP1</title>
    <script src="{% static 'fontawesomefree/js/all.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.inputmask/5.0.6/jquery.inputmask.min.js"></script>
    <link href="{% static 'fontawesomefree/css/all.css' %}" rel="stylesheet" type="text/css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      .modal-overlay {
		  display: none;
		  position: fixed;
		  top: 0;
		  left: 0;
		  width: 100%;
		  height: 100%;
		  background-color: rgba(0, 0, 0, 0.5);
		  z-index: 1000;
		  justify-content: center;
		  align-items: center;
	  }

	  .modal-content {
		  background-color: white;
		  border-radius: 5px;
		  width: 90%;
		  max-width: 500px;
		  max-height: 90vh;
		  overflow-y: auto;
	  }

	  .modal-header {
		  padding: 15px;
		  border-bottom: 1px solid #eee;
		  display: flex;
		  justify-content: space-between;
		  align-items: center;
	  }

	  .modal-body {
		  padding: 15px;
	  }

	  .modal-footer {
		  padding: 15px;
		  border-top: 1px solid #eee;
		  display: flex;
		  justify-content: flex-end;
		  gap: 10px;
	  }

	  .close {
		  font-size: 1.5rem;
		  font-weight: bold;
		  cursor: pointer;
		  background: none;
		  border: none;
	  }
      .alert-container {
          position: fixed;
          top: 20px;
          right: 20px;
          z-index: 1100;
          max-width: 400px;
          width: 100%;
      }
      
      .alert {
          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
          border: none;
          border-left: 4px solid;
          animation: slideIn 0.5s forwards, fadeOut 0.5s forwards 3s;
      }
      
      .alert-success {
          background-color: #f0fff4;
          border-left-color: #38a169;
          color: #2f855a;
      }
      
      .alert-error {
          background-color: #fff5f5;
          border-left-color: #e53e3e;
          color: #c53030;
      }
      
      .alert-info {
          background-color: #ebf8ff;
          border-left-color: #3182ce;
          color: #2b6cb0;
      }
      
      .alert-warning {
          background-color: #fffaf0;
          border-left-color: #dd6b20;
          color: #c05621;
      }
      
      @keyframes slideIn {
          from {
              transform: translateX(100%);
              opacity: 0;
          }
          to {
              transform: translateX(0);
              opacity: 1;
          }
      }
      
      @keyframes fadeOut {
          from {
              opacity: 1;
          }
          to {
              opacity: 0;
          }
      }
      
      .close-message {
          cursor: pointer;
          background: none;
          border: none;
          font-size: 1.2rem;
          line-height: 1;
          color: inherit;
          opacity: 0.7;
          transition: opacity 0.2s;
      }
      
      .close-message:hover {
          opacity: 1;
      }
    </style>
  </head>
  <body>

	<div class="container py-4">
      <h1 class="text-center mb-4">MEU APP SIMPLES</h1>
      
      <div class="text-center mb-4">
        <button onclick="openModal('add_pessoa')" class="btn btn-success">
          <i class="fas fa-plus"></i> Adicionar Cliente
        </button>
      </div>
	</div>

	<div class="alert-container">
      {% if messages %}
      {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        <div class="d-flex align-items-center">
          {% if message.tags == 'success' %}
          <i class="fas fa-check-circle me-2"></i>
          {% elif message.tags == 'error' %}
          <i class="fas fa-exclamation-circle me-2"></i>
          {% elif message.tags == 'info' %}
          <i class="fas fa-info-circle me-2"></i>
          {% elif message.tags == 'warning' %}
          <i class="fas fa-exclamation-triangle me-2"></i>
          {% endif %}
          <div>{{ message }}</div>
        </div>
        <button type="button" class="close-message" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      {% endfor %}
      {% endif %}
	</div>

    <div class="table-responsive">
      <table class="table table-striped table-hover">
        <thead class="thead-light">
          <tr>
            <th>ID</th>
            <th>Nome</th>
            <th>Idade</th>
            <th>CPF</th>
            <th>Editar</th>
            <th>Excluir</th>
          </tr>
        </thead>
        <tbody>
          {% for pessoa in pessoas %}
          <tr>
            <td>{{ pessoa.id }}</td>
            <td>{{ pessoa.nome }}</td>
            <td>{{ pessoa.idade }}</td>
            <td>{{ pessoa.cpf }}</td>
            <td>
              <button onclick="openModal('editar_{{ pessoa.id }}')" class="btn btn-primary">
                <i class="fas fa-edit"></i> Editar
              </button>
            </td>
            <td>
              <button onclick="openModal('deletar_{{ pessoa.id }}')" class="btn btn-danger">
                <i class="fas fa-trash"></i> Apagar
              </button>
            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6" class="text-center">Nenhum cadastro encontrado.</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    <!-- Modal Adicionar Pessoa -->
    <div id="add_pessoa" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Adicionar Cliente</h5>
          <button type="button" onclick="closeModal('add_pessoa')" class="close">&times;</button>
        </div>
        <form class="modal-body" method="post">
          {% csrf_token %}
          <div class="form-group">
            <label for="nome" class="form-label">Nome <span style="color: red">*</span></label>
            <input type="text" name="nome" id="nome" class="form-control" placeholder="Nome da pessoa" required>
          </div>
          <div class="form-group">
            <label for="idade" class="form-label">Idade <span style="color: red">*</span></label>
            <input type="text" name="idade" id="idade" class="form-control" placeholder="Idade" required>
          </div>
          <div class="form-group">
            <label for="cpf" class="form-label">CPF <span style="color: red">*</span></label>
            <input type="text" name="cpf" id="cpf" class="mascara_cpf form-control" placeholder="CPF" required>
          </div>
          <div class="modal-footer">
            <button type="button" onclick="closeModal('add_pessoa')" class="btn btn-secondary">Cancelar</button>
            <button type="submit" name="add_pessoa" class="btn btn-primary">
              <i class="fas fa-plus"></i> Adicionar Cliente
            </button>
          </div>
        </form>
      </div>
    </div>

    {% for pessoa in pessoas %}
    <!-- Modal Deletar Pessoa -->
    <div id="deletar_{{ pessoa.id }}" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Confirmar Exclusão</h5>
          <button type="button" onclick="closeModal('deletar_{{ pessoa.id }}')" class="close">&times;</button>
        </div>
        <form class="modal-body" method="POST">
          {% csrf_token %}
          <div class="text-center">
            <i class="fas fa-exclamation-triangle fa-3x text-danger mb-3"></i>
            <p>Apagar Pessoa de Nome: <strong>{{ pessoa.nome }}</strong>?</p>
          </div>
          <div class="modal-footer">
			<input type="hidden" name="id_pessoa" value="{{ pessoa.id }}">
            <button type="button" onclick="closeModal('deletar_{{ pessoa.id }}')" class="btn btn-secondary">Cancelar</button>
            <button name="deletar" type="submit" class="btn btn-danger">
              <i class="fas fa-trash"></i> Apagar
            </button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Editar Pessoa -->
    <div id="editar_{{ pessoa.id }}" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Editar Cliente {{ pessoa.id }}</h5>
          <button type="button" onclick="closeModal('editar_{{ pessoa.id }}')" class="close">&times;</button>
        </div>
        <form class="modal-body" method="post">
          {% csrf_token %}
          <input type="hidden" name="id_pessoa" value="{{ pessoa.id }}">
          <div class="form-group">
            <label for="nome" class="form-label">Nome</label>
            <input type="text" name="nome" value="{{ pessoa.nome }}" id="nome" class="form-control" placeholder="Nome da pessoa" required>
          </div>
          <div class="form-group">
            <label for="idade" class="form-label">Idade</label>
            <input type="text" value="{{ pessoa.idade }}" name="idade" id="idade" class="form-control" placeholder="Idade" required>
          </div>
          <div class="form-group">
            <label for="cpf" class="form-label">CPF</label>
            <input type="text" value="{{ pessoa.cpf }}" name="cpf" id="cpf" class="mascara_cpf form-control" placeholder="CPF" required>
          </div>
          <div class="modal-footer">
            <button type="button" onclick="closeModal('editar_{{ pessoa.id }}')" class="btn btn-secondary">Cancelar</button>
            <button type="submit" name="editar" class="btn btn-primary">
              <i class="fas fa-save"></i> Salvar Alterações
            </button>
          </div>
        </form>
      </div>
    </div>
    {% endfor %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
<script>
  // Funções para controle dos modais
  function openModal(modalId) {
      document.getElementById(modalId).style.display = 'flex';
      document.body.style.overflow = 'hidden';
  }
  
  function closeModal(modalId) {
      document.getElementById(modalId).style.display = 'none';
      document.body.style.overflow = 'auto';
  }
  
  // Fechar modal ao clicar fora do conteúdo
  window.onclick = function(event) {
      if (event.target.classList.contains('modal-overlay')) {
          event.target.style.display = 'none';
          document.body.style.overflow = 'auto';
      }
  }
</script>

<script>
  $(document).ready(function () {
      $(".mascara_telefone").inputmask("(99) 99999-9999");
      //$('.mascara_rg').inputmask("99.999.999-9");
      $(".mascara_cnpj").inputmask("99.999.999/9999-99");
      $(".mascara_cep").inputmask("99999-999");
      $(".mascara_cpf").inputmask("999.999.999-99");
  });
</script>

</body>
</html>
